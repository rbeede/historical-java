
  

  
  

  
  

  

  
  

  
  

  
  

  

  

  

  

  

  
  
  
  
      
  

      
      
      
      
      
      
        
         
      
      

      
      
      
      

      
      
      

      

  
  

  
  

   
   

   
   


    
	
	

    
    
      
	
	
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

    <html>
      <head>
        
        
        
          <title>HttpClient - 
          HttpClient Tutorial
        </title>
        
        
        <style type="text/css">
          @import url("./style/tigris.css");
          @import url("./style/maven.css");
        </style>
        
        
        
        
        
        <link rel="stylesheet" href="./style/print.css" type="text/css" media="print"></link>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta>
        
          <meta name="author" content="Adrian Sutton"></meta>
          <meta name="email" content="adrian@ephox.com"></meta>
        
        
        
        
      </head>

      <body class="composite">

        <div id="banner">
          <table border="0" width="100%" cellpadding="8" cellspacing="0">
            <tr>
              
              <td>
                
                
                  
                  
                  
                    
                  
                  
                  
                  
                  
                  <a href="http://jakarta.apache.org/">
                    <img border="0" alt="Apache Software Foundation" src="http://jakarta.apache.org/commons/images/jakarta-logo-blue.gif" align="left"></img>
                  </a>
                
              </td>

              
              <td>
                <div id="login" align="right">
                  
                  
                    
                    
                    
                      
                    

                    <a href="http://jakarta.apache.org/commons/httpclient/">
                      <img border="0" alt="HttpClient" src="./images/httpclient_logo.png" align="right"></img>
                    </a>
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        <div id="breadcrumbs">
          <table border="0" width="100%" cellpadding="4" cellspacing="0">
            <tr>
              
                
                <td>Last published: 13 October 2003
                  | Doc for 2.0-rc2
                </td>
              
              <td>
                <div align="right">
                  
                  
                  
                  
                    
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        
        <table border="0" width="100%" cellpadding="8" cellspacing="0"> 
          <tr valign="top">
            <td width="20%" id="leftcol">
              <div id="navcolumn">
                

                
                  
    <div>
      <strong>Overview</strong>
      
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="features.html"><img class="handle" src="./images/none.png" alt=""></img>Features</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="news.html"><img class="handle" src="./images/none.png" alt=""></img>News</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="status.html"><img class="handle" src="./images/none.png" alt=""></img>Status</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="downloads.html"><img class="handle" src="./images/none.png" alt=""></img>Download</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="applications.html"><img class="handle" src="./images/none.png" alt=""></img>Applications</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		
          
		
		
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="userguide.html"><img class="handle" src="./images/expanded.png" alt=""></img>User Guide</a>
      	
      </small>
	  
        
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="authentication.html"><img class="handle" src="./images/none.png" alt=""></img>Authentication Guide</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="charencodings.html"><img class="handle" src="./images/none.png" alt=""></img>Character Encodings</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="cookies.html"><img class="handle" src="./images/none.png" alt=""></img>Cookies</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="redirects.html"><img class="handle" src="./images/none.png" alt=""></img>Cross Host Redirects</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="logging.html"><img class="handle" src="./images/none.png" alt=""></img>Logging Guide</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="methods.html"><img class="handle" src="./images/none.png" alt=""></img>Methods</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="http://cvs.apache.org/viewcvs.cgi/jakarta-commons/httpclient/src/examples/"><img class="handle" src="./images/none.png" alt=""></img>Sample Code</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="sslguide.html"><img class="handle" src="./images/none.png" alt=""></img>SSL Guide</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="threading.html"><img class="handle" src="./images/none.png" alt=""></img>Threading</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="troubleshooting.html"><img class="handle" src="./images/none.png" alt=""></img>Trouble Shooting</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      		<b><a href="tutorial.html"><img class="handle" src="./images/none.png" alt=""></img>Tutorial</a></b>
      	
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    
    
    
    
	
	
	
	
	
		
          
		
		
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="developerguide.html"><img class="handle" src="./images/expanded.png" alt=""></img>Developer Guide</a>
      	
      </small>
	  
        
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="releases.html"><img class="handle" src="./images/none.png" alt=""></img>Release Process</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="testwebapp.html"><img class="handle" src="./images/none.png" alt=""></img>Webapp Test Guide</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    </div>
  
                

				
    <div>
      <strong>Project Documentation</strong>
      
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="index.html"><img class="handle" src="./images/none.png" alt=""></img>About HttpClient</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		
		
          
		
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="project-info.html"><img class="handle" src="./images/collapsed.png" alt=""></img>Project Info</a>
      	
      </small>
	  
    </div>
  
    
    
    
    
	
	
	
	
	
		
		
          
		
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="maven-reports.html"><img class="handle" src="./images/collapsed.png" alt=""></img>Project Reports</a>
      	
      </small>
	  
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="apidocs/index.html"><img class="handle" src="./images/none.png" alt=""></img>JavaDocs</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="xref/index.html"><img class="handle" src="./images/none.png" alt=""></img>Source XReference</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="xref-test/index.html"><img class="handle" src="./images/none.png" alt=""></img>Test XReference</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="http://maven.apache.org/development-process.html"><img class="handle" src="./images/none.png" alt=""></img>Development Process</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
                
                
                

                
                
                
                
                	<div style="margin-top: 20px; width: 100%; text-align: center;">
                		<a href="http://maven.apache.org/" title="Powered by Maven"><img style="border: 1px solid black" alt="Powered by Maven" src="./images/logos/maven-propaganda.png"></img></a>
                	</div>
                
              
                
              </div>
            </td>
            <td rowspan="2">
              <div id="bodycol">
                
                <div class="app">
                  
                  
    <div class="h3">
      
      
        <h3>
          <a name="Overview">Overview</a>
        </h3>
      
      
    <p>
      
     This tutorial is designed to provide a basic overview of how to use
   
     
        
   
    <em>
      
     HttpClient
   
    </em>
   
     .  When you have completed the tutorial you will have written
   
     
        a simple application that downloads a page using 
   
    <em>
      
     HttpClient
   
    </em>
   
     .
   
    </p>
   
    <p>
      
     It is assumed that you have an understanding of how to program in
   
     
      Java and are familiar with the development environment you are using.
   
    </p>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Getting Ready">Getting Ready</a>
        </h3>
      
      
    <p>
      
     The first thing you need to do is get a copy of 
   
    <em>
      
     HttpClient
   
    </em>
   
      and it's
   
     
      dependencies.  Currently the only required dependency is
   
     
      
   
    <a href="/commons/logging/">
     commons-logging
   </a>
  
     .  This tutorial was
   
     
      written for 
   
    <em>
      
     HttpClient
   
    </em>
   
      2.0 and at a minimum requires 2.0 Alpha
   
     
      2.  You will also need JDK 1.2.2 or above.
   
    </p>
   
    <p>
      
     Once you've downloaded 
   
    <em>
      
     HttpClient
   
    </em>
   
      and commons-logging you'll need to
   
     
      put them on your classpath.  There is also an optional dependency on JSSE
   
     
      which is required for HTTPS connections;  this is not required for this
   
     
      tutorial.
   
    </p>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Concepts">Concepts</a>
        </h3>
      
      
    <p>
      
     The general process for using 
   
    <em>
      
     HttpClient
   
    </em>
   
      consists of a number of
   
     
      steps:
   
    </p>
   
    <ol>
      
     
        
   
    <li>
      
     Create an instance of 
   
    <code>
      
     HttpClient
   
    </code>
   
     .
   
    </li>
   
     
        
   
    <li>
      
     Create an instance of one of the methods (GetMethod in this
   
     
        case).  The URL to connect to is passed in to the the method
   
     
        constructor.
   
    </li>
   
     
        
   
    <li>
      
     Tell 
   
    <code>
      
     HttpClient
   
    </code>
   
      to execute the method.
   
    </li>
   
     
        
   
    <li>
      
     Read the response.
   
    </li>
   
     
        
   
    <li>
      
     Release the connection.
   
    </li>
   
     
        
   
    <li>
      
     Deal with the response.
   
    </li>
   
     
      
   
    </ol>
   
    <p>
      
     We'll cover how to perform each of these steps below.  Notice that we
   
     
      go through the entire process r
   
     egardless of whether the server returned
   
     
      an error or not.  This is important because HTTP 1.1 allows multiple
   
     
      requests to use the same connection by simply sending the requests one
   
     
      after the other.  Obviously, if we don't read the entire response to
   
     
      the first request, the left over data will get in the way of the second
   
     
      response.  
   
    <em>
      
     HttpClient
   
    </em>
   
      tries to handle this but to avoid problems it is
   
     
      important to always read the entire response and release the connection.
   
    </p>
   
    <div style="font-style: italic; border: 1px solid #888; margin-left: 7px; margin-right: 7px; margin-top: 1em; margin-bottom: 1px;">
      
     
        
   
    <p>
      
     
          It is important to always read the entire
   
     
          response and release the connection regardless of whether the server
   
     
          returned an error or not.
   
     
        
   
    </p>
   
     
      
   
    </div>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Instantiating HttpClient">Instantiating HttpClient</a>
        </h3>
      
      
    <p>
      
     The no argument constructor for 
   
    <code>
      
     HttpClient
   
    </code>
   
      provides a good set of
   
     
      defaults for most situations so that is what we'll use.
   
    </p>
   
    <div id="source">
      <pre>HttpClient client = new HttpClient();</pre>
    </div>
  
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Creating a Method">Creating a Method</a>
        </h3>
      
      
    <p>
      
     The various methods defined by the HTTP specification correspond to
   
     
        the various classes in 
   
    <em>
      
     HttpClient
   
    </em>
   
      which implement the HttpMethod
   
     
      interface.  These classes are all found in the package
   
     
      
   
    <code>
      
     org.apache.commons.httpclient.methods
   
    </code>
   
     .
   
    </p>
   
    <p>
      
     We will be using the Get method which is a simple method that simply
   
     
      takes a URL and gets the document the URL points to.
   
    </p>
   
    <div id="source">
      <pre>HttpMethod method = new GetMethod("http://www.apache.org/");</pre>
    </div>
  
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Execute the Method">Execute the Method</a>
        </h3>
      
      
    <p>
      
     The actual execution of the method is performed by calling
   
     
      
   
    <code>
      
     executeMethod
   
    </code>
   
      on the client and passing in the method to
   
     
      execute.  Since networks connections are unreliable, we also need to deal
   
     
      with any errors that occur.
   
    </p>
   
    <p>
      
     There are two kinds
   
      of exceptions that could be thrown by
   
     
      executeMethod, 
   
    <code>
      
     HttpRecoverableException
   
    </code>
   
      and
   
     
      
   
    <code>
      
     IOException
   
    </code>
   
     .
   
    </p>
   
    <div class="h4">
      
      
        <h4>
          <a name="HttpRecoverableException">HttpRecoverableException</a>
        </h4>
      
      
    <p>
      
     A HttpRecoverableException is thrown when an error occurs that is
   
     
          likely to be a once-off problem.  Usually the request will succeed on
   
     
          a second attempt, so retrying the connection is generally
   
     
          recommended.  Note that HttpRecoverableException actually extends
   
     
          IOException so you can just ignore it and catch the IOException if
   
     
          your application does not retry the request.
   
    </p>
   
    </div>
  
    <div class="h4">
      
      
        <h4>
          <a name="IOException">IOException</a>
        </h4>
      
      
    <p>
      
     An IOException is thrown when the request cannot be sent at all
   
     
          and retrying the connection is also likely to fail.  This may be
   
     
          caused by a number of situations including the server being down,
   
     
          inability to resolve the domain name or the server refusing the
   
     
          connection.
   
    </p>
   
    </div>
  
    <p>
      
     The other useful piece of information is the status code that is
   
     
        returned by the server.  This code is returned by executeMethod as an
   
     
        int and can be used to determine if the request was successful or not
   
     
        and can sometimes indicate that further action is required by the
   
     
        client such as providing authentication credentials.
   
    </p>
   
    <div id="source">
      <pre>
          int statusCode = -1;
          // We will retry up to 3 times.
          for (int attempt = 0; statusCode == -1 &amp;&amp; attempt &lt; 3; attempt++) {
              try {
                  // execute the method.
                  statusCode = client.executeMethod(method);
              } catch (HttpRecoverableException e) {
                  System.err.println("A recoverable exception occurred,
                  retrying.  " + e.getMessage());
              } catch (IOException e) {
                  System.err.println("Failed to download file.");
                  e.printStackTrace();
                  System.exit(-1);
              }
          }
          // Check that we didn't run out of retries.
          if (statusCode == -1) {
              System.err.println("Failed to recover from exception.");
              System.exit(-2);
          }
        </pre>
    </div>
  
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Read the Response">Read the Response</a>
        </h3>
      
      
    <p>
      
     It is vital that the response body is always read regardless of the
   
     
      status returned by the server.  There are three ways to do this:
   
    </p>
   
    <ul>
      
     
        
   
    <li>
      
     Call 
   
    <code>
      
     method.getResponseBody()
   
    </code>
   
     .  This will return a
   
     
        byte array containing the data in the response body.
   
    </li>
   
     
        
   
    <li>
      
     Call 
   
    <code>
      
     method.getResponseBodyAsString()
   
    </code>
   
     .  This will
   
     
        return a String containing the response body.  Be warned though that
   
     
        the conversion from bytes to a String is done using the default
   
     
        encoding so this method may not be portable across all platforms.
   
    </li>
   
     
        
   
    <li>
      
     Call 
   
    <code>
      
     method.getResponseBodyAsStream()
   
    </code>
   
      and read the
   
     
        entire contents of the stream then call 
   
    <code>
      
     stream.close()
   
    </code>
   
     .
   
     
        This method is best if it is possible for a lot of data to be received
   
     
        as it can be buffered to a file or processed as it is read.  Be sure to
   
     
        always read the entirety of the data and call close on the stream.
   
    </li>
   
     
      
   
    </ul>
   
    <p>
      
     For this tutorial we will use 
   
    <code>
      
     getResponseBody()
   
    </code>
   
      for simplicity.
   
    </p>
   
    <div id="source">
      <pre>byte[] responseBody = method.getResponseBody();</pre>
    </div>
  
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Release the Connection">Release the Connection</a>
        </h3>
      
      
    <p>
      
     This is a crucial step to keep things flowing.  We must tell
   
     
        
   
    <em>
      
     HttpClient
   
    </em>
   
      that we are done with the connection and that it can now be
   
     
        reused.  Without doing this 
   
    <em>
      
     HttpClient
   
    </em>
   
      will wait indefinitely for a
   
     
        connection to free up so that it can be reused.
   
    </p>
   
    <div id="source">
      <pre>method.releaseConnection();</pre>
    </div>
  
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Deal with the Repsonse">Deal with the Repsonse</a>
        </h3>
      
      
    <p>
      
     We've now completed our interaction with 
   
    <em>
      
     HttpClient
   
    </em>
   
      and can just
   
     
      concentrate on doing what we need to do with the data.  In our case,
   
     
      we'll just print it out to the console.
   
    </p>
   
    <p>
      
     It's worth noting that if you were retrieving the response as a stream
   
     
      and processing it as it is read, this step would actually be combined
   
     
      with reading the connection, and when you'd finished processing all the
   
     
      data, you'd then close the input stream and release the connection.
   
    </p>
   
    <p>
      
     Note: We should pay attention to character encodings here instead of
   
     
      just using the system default.
   
    </p>
   
    <div id="source">
      <pre>System.err.println(new String(responseBody));</pre>
    </div>
  
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Final Source Code">Final Source Code</a>
        </h3>
      
      
    <p>
      
     When we put all of that together plus a little bit of glue code we get
   
     
      the program below.
   
    </p>
   
    <div id="source">
      <pre>
        import org.apache.commons.httpclient.*;
        import org.apache.commons.httpclient.methods.*;
        import java.io.*;

        public class HttpClientTutorial {
          
          private static String url = "http://www.apache.org/";

          public static void main(String[] args) {
            // Create an instance of HttpClient.
            HttpClient client = new HttpClient();

            // Create a method instance.
            HttpMethod method = new GetMethod(url);

            // Execute the method.
            int statusCode = -1;
            int attempt = 0;
            // We will retry up to 3 times.
            while (statusCode == -1 &amp;&amp; attempt &lt; 3) {
              try {
                // execute the method.
                statusCode = client.executeMethod(method);
              } catch (HttpRecoverableException e) {
                System.err.println(
                  "A recoverable exception occurred, retrying." + 
                  e.getMessage());
              } catch (IOException e) {
                System.err.println("Failed to download file.");
                e.printStackTrace();
                System.exit(-1);
              }
            }
            // Check that we didn't run out of retries.
            if (statusCode == -1) {
              System.err.println("Failed to recover from exception.");
              System.exit(-2);
            }

            // Read the response body.
            byte[] responseBody = method.getResponseBody();

            // Release the connection.
            method.releaseConnection();

            // Deal with the response.
            // Use caution: ensure correct character encoding and is not binary data
            System.err.println(new String(responseBody));
          }
        }
      </pre>
    </div>
  
    </div>
  
                  
                  
                  
                  
                  
                </div>
              </div>
            </td>
          </tr>
        </table>
        <div id="footer">
          <table border="0" style="width:100%" cellpadding="4" cellspacing="0">
            
            <tr>
              <td>
                
                  
                    
                    
                      © 2001-2003, Apache Software Foundation
                    
                  
                  
                

                
              </td>
              
            </tr>
          </table>
        </div>
      </body>
    </html>
  