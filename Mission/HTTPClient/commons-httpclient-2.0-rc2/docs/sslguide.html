
  

  
  

  
  

  

  
  

  
  

  
  

  

  

  

  

  

  
  
  
  
      
  

      
      
      
      
      
      
        
         
      
      

      
      
      
      

      
      
      

      

  
  

  
  

   
   

   
   


    
	
	

    
    
      
	
	
	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

    <html>
      <head>
        
        
        
          <title>HttpClient - 
          HttpClient SSL Guide
        </title>
        
        
        <style type="text/css">
          @import url("./style/tigris.css");
          @import url("./style/maven.css");
        </style>
        
        
        
        
        
        <link rel="stylesheet" href="./style/print.css" type="text/css" media="print"></link>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta>
        
          <meta name="author" content="Oleg Kalnichevski"></meta>
          <meta name="email" content="oleg@ural.ru"></meta>
        
          <meta name="author" content="Adrian Sutton"></meta>
          <meta name="email" content="adrian@intencha.com"></meta>
        
        
        
        
      </head>

      <body class="composite">

        <div id="banner">
          <table border="0" width="100%" cellpadding="8" cellspacing="0">
            <tr>
              
              <td>
                
                
                  
                  
                  
                    
                  
                  
                  
                  
                  
                  <a href="http://jakarta.apache.org/">
                    <img border="0" alt="Apache Software Foundation" src="http://jakarta.apache.org/commons/images/jakarta-logo-blue.gif" align="left"></img>
                  </a>
                
              </td>

              
              <td>
                <div id="login" align="right">
                  
                  
                    
                    
                    
                      
                    

                    <a href="http://jakarta.apache.org/commons/httpclient/">
                      <img border="0" alt="HttpClient" src="./images/httpclient_logo.png" align="right"></img>
                    </a>
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        <div id="breadcrumbs">
          <table border="0" width="100%" cellpadding="4" cellspacing="0">
            <tr>
              
                
                <td>Last published: 13 October 2003
                  | Doc for 2.0-rc2
                </td>
              
              <td>
                <div align="right">
                  
                  
                  
                  
                    
                  
                </div>
              </td>
            </tr>
          </table>
        </div>
        
        <table border="0" width="100%" cellpadding="8" cellspacing="0"> 
          <tr valign="top">
            <td width="20%" id="leftcol">
              <div id="navcolumn">
                

                
                  
    <div>
      <strong>Overview</strong>
      
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="features.html"><img class="handle" src="./images/none.png" alt=""></img>Features</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="news.html"><img class="handle" src="./images/none.png" alt=""></img>News</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="status.html"><img class="handle" src="./images/none.png" alt=""></img>Status</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="downloads.html"><img class="handle" src="./images/none.png" alt=""></img>Download</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="applications.html"><img class="handle" src="./images/none.png" alt=""></img>Applications</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		
          
		
		
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="userguide.html"><img class="handle" src="./images/expanded.png" alt=""></img>User Guide</a>
      	
      </small>
	  
        
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="authentication.html"><img class="handle" src="./images/none.png" alt=""></img>Authentication Guide</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="charencodings.html"><img class="handle" src="./images/none.png" alt=""></img>Character Encodings</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="cookies.html"><img class="handle" src="./images/none.png" alt=""></img>Cookies</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="redirects.html"><img class="handle" src="./images/none.png" alt=""></img>Cross Host Redirects</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="logging.html"><img class="handle" src="./images/none.png" alt=""></img>Logging Guide</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="methods.html"><img class="handle" src="./images/none.png" alt=""></img>Methods</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="http://cvs.apache.org/viewcvs.cgi/jakarta-commons/httpclient/src/examples/"><img class="handle" src="./images/none.png" alt=""></img>Sample Code</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      		<b><a href="sslguide.html"><img class="handle" src="./images/none.png" alt=""></img>SSL Guide</a></b>
      	
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="threading.html"><img class="handle" src="./images/none.png" alt=""></img>Threading</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="troubleshooting.html"><img class="handle" src="./images/none.png" alt=""></img>Trouble Shooting</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="tutorial.html"><img class="handle" src="./images/none.png" alt=""></img>Tutorial</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    
    
    
    
	
	
	
	
	
		
          
		
		
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="developerguide.html"><img class="handle" src="./images/expanded.png" alt=""></img>Developer Guide</a>
      	
      </small>
	  
        
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="releases.html"><img class="handle" src="./images/none.png" alt=""></img>Release Process</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="testwebapp.html"><img class="handle" src="./images/none.png" alt=""></img>Webapp Test Guide</a>
      	
      </small>
	  
        
      
    </div>
  
      
    </div>
  
    </div>
  
                

				
    <div>
      <strong>Project Documentation</strong>
      
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="index.html"><img class="handle" src="./images/none.png" alt=""></img>About HttpClient</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		
		
          
		
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="project-info.html"><img class="handle" src="./images/collapsed.png" alt=""></img>Project Info</a>
      	
      </small>
	  
    </div>
  
    
    
    
    
	
	
	
	
	
		
		
          
		
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="maven-reports.html"><img class="handle" src="./images/collapsed.png" alt=""></img>Project Reports</a>
      	
      </small>
	  
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="apidocs/index.html"><img class="handle" src="./images/none.png" alt=""></img>JavaDocs</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="xref/index.html"><img class="handle" src="./images/none.png" alt=""></img>Source XReference</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="xref-test/index.html"><img class="handle" src="./images/none.png" alt=""></img>Test XReference</a>
      	
      </small>
	  
        
      
    </div>
  
    
    
    
    
	
	
	
	
	
		   
	
    <div>
      <small>
      	
      	
      		<a href="http://maven.apache.org/development-process.html"><img class="handle" src="./images/none.png" alt=""></img>Development Process</a>
      	
      </small>
	  
        
      
    </div>
  
    </div>
  
                
                
                

                
                
                
                
                	<div style="margin-top: 20px; width: 100%; text-align: center;">
                		<a href="http://maven.apache.org/" title="Powered by Maven"><img style="border: 1px solid black" alt="Powered by Maven" src="./images/logos/maven-propaganda.png"></img></a>
                	</div>
                
              
                
              </div>
            </td>
            <td rowspan="2">
              <div id="bodycol">
                
                <div class="app">
                  
                  
    <div class="h3">
      
      
        <h3>
          <a name="Introduction">Introduction</a>
        </h3>
      
      
    <p>
      
     
       HttpClient provides full support for HTTP over Secure Sockets Layer (SSL) or IETF Transport Layer
   
     
       Security (TLS) protocols by leveraging the 
   
    <a href="http://java.sun.com/products/jsse/index.html">
     
       Java Secure Socket Extension (JSSE)
   </a>
  
     . JSSE has been integrated into the Java 2 platform as of 
   
     
       version 1.4 and works with HttpClient out of the box. On older Java 2 versions JSSE 
   
     
       needs to be manually installed and configured. Installation instructions can be found
   
     
       
   
    <a href="http://java.sun.com/products/jsse/doc/guide/API_users_guide.html#Installation">
     here
   </a>
  
     
     
   
    </p>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Standard SSL in HttpClient">Standard SSL in HttpClient</a>
        </h3>
      
      
    <p>
      
     
        Once you have JSSE correctly installed, secure HTTP communication over SSL should be as simple 
   
     
        as plain HTTP communication. 
   
     
      
   
    </p>
   
    <div id="source">
      <pre>
  HttpClient httpclient = new HttpClient();
  GetMethod httpget = new GetMethod("https://www.verisign.com/"); 
  httpclient.executeMethod(httpget);
  System.out.println(httpget.getStatusLine().toString());
      </pre>
    </div>
  
    <p>
      
     
        HTTPS communication via an authenticating proxy server is also no different from plain HTTP 
   
     
        communication. All the low-level details of establishing a tunneled SSL connection are handled
   
     
        by HttpClient:
   
     
      
   
    </p>
   
    <div id="source">
      <pre>
  HttpClient httpclient = new HttpClient();
  httpclient.getHostConfiguration().setProxy("myproxyhost", 8080);
  httpclient.getState().setProxyCredentials("my-proxy-realm", " myproxyhost",
  new UsernamePasswordCredentials("my-proxy-username", "my-proxy-password"));
  GetMethod httpget = new GetMethod("https://www.verisign.com/"); 
  httpclient.executeMethod(httpget);
  System.out.println(httpget.getStatusLine().toString());
      </pre>
    </div>
  
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Customizing SSL in HttpClient">Customizing SSL in HttpClient</a>
        </h3>
      
      
    <p>
      
     
      The default behaviour of HttpClient is suitable for most uses, however
   
     
      there are some aspects which you may want to configure.  The most common
   
     
      requirements for customizing SSL are:
   
    </p>
   
    <ul>
      
     
      
   
    <li>
      
     Ability to accept self-signed or untrusted SSL certificates.  This
   
     
      is highlighted by an 
   
    <code>
      
     SSLException
   
    </code>
   
      with the message
   
     
      
   
    <i>
      
     Unrecognized SSL handshake
   
    </i>
   
      (or similar) being thrown when a
   
     
      connection attempt is made.
   
    </li>
   
     

      
   
    <li>
      
     You want to use a third party SSL library instead of Sun's default
   
     
      implementation.
   
    </li>
   
     
    
   
    </ul>
   
    <p>
      
     
     Implementation of a custom protocol involves the following steps:
   
     
    
   
    </p>
   
    <ol>
      
     

      
   
    <li>
      
     
       
   
    <p>
      
     
       Provide a custom socket factory that implements 
   
     
       
   
    <a href="apidocs/org/apache/commons/httpclient/protocol/SecureProtocolSocketFactory.html">
     
       org.apache.commons.httpclient.protocol.SecureProtocolSocketFactory
   </a>
  
      interface. The socket 
   
     
       factory is responsible for opening a socket to the target server 
   
     
       using either the standard or a third party SSL library and
   
     
       performing any required initialization such as performing the
   
     
       connection handshake.  Generally the initialization is performed
   
     
       automatically when the socket is created.
   
     
       
   
    </p>
   
     
      
   
    </li>
   
     

      
   
    <li>
      
     
       
   
    <p>
      
     
       Instantiate an object of type 
   
    <a href="apidocs/org/apache/commons/httpclient/protocol/Protocol.html">
     
       org.apache.commons.httpclient.protocol.Protocol
   </a>
  
     .  The new instance
   
     
       would be created with a valid URI protocol scheme (https in this
   
     
       case), the custom socket factory (discussed above) and a default port
   
     
       number (typically 443 for https).  For example:
   
     
       
   
    </p>
   
     

      
   
    <div id="source">
      <pre>
Protocol myhttps = new Protocol("https", new MySSLSocketFactory(), 443);
      </pre>
    </div>
  
     

      
   
    <p>
      
     
      The new instance of protocol can then be set as the protocol handler
   
     
      for a HostConfiguration.  For example to configure the default host and
   
     
      protocol handler for a HttpClient instance use:
   
     
      
   
    </p>
   
     

      
   
    <div id="source">
      <pre>
HttpClient httpclient = new HttpClient();
httpclient.getHostConfiguration().setHost("www.whatever.com", 443, myhttps);
GetMethod httpget = new GetMethod("/");
httpclient.executeMethod(httpget);
      </pre>
    </div>
  
     

      
   
    </li>
   
     

      
   
    <li>
      
     
       
   
    <p>
      
     
        Finally, you can register your custom protocol as the default handler
   
     
        for a specific protocol designator (eg: https) by calling the
   
     
        Protocol.registerProtocol method.  You can specify your own protocol
   
     
        designator (such as 'myhttps') if you need to use your custom
   
     
        protocol as well as the default SSL protocol implementation.
   
     
       
   
    </p>
   
     

      
   
    <div id="source">
      <pre>
Protocol.registerProtocol("myhttps", 
new Protocol("https", new MySSLSocketFactory(), 9443));
      </pre>
    </div>
  
     

       
   
    <p>
      
     
        Once registered the protocol be used as a 'virtual' scheme inside target URIs.
   
     
       
   
    </p>
   
     

      
   
    <div id="source">
      <pre>
HttpClient httpclient = new HttpClient();
GetMethod httpget = new GetMethod("myhttps://www.whatever.com/");
httpclient.executeMethod(httpget);
      </pre>
    </div>
  
     

      
   
    <p>
      
     
       If you want this protocol to represent the default SSL protocol implementation, simply register
   
     
       it under 'https' designator, which will make the protocol object take place of the existing one
   
     
      
   
    </p>
   
     

      
   
    <div id="source">
      <pre>
Protocol.registerProtocol("https", 
new Protocol("https", new MySSLSocketFactory(), 443));
HttpClient httpclient = new HttpClient();
GetMethod httpget = new GetMethod("https://www.whatever.com/");
httpclient.executeMethod(httpget);
      </pre>
    </div>
  
     

      
   
    </li>
   
     

    
   
    </ol>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Examples of SSL customization in HttpClient">Examples of SSL customization in HttpClient</a>
        </h3>
      
      
    <p>
      
     
     There are several custom socket factories available in our contribution
   
     
     
   
     package. They can be a good start for those who seek to tailor the
   
     
     behavior of the HTTPS protocol to the specific needs of their
   
     
     application:
   
     
    
   
    </p>
   
    <ul>
      
     

        
   
    <li>
      
     
         
   
    <a href="http://cvs.apache.org/viewcvs.cgi/jakarta-commons/httpclient/src/contrib/org/apache/commons/httpclient/contrib/ssl/EasySSLProtocolSocketFactory.java?rev=HEAD">
       
   
     
          EasySSLProtocolSocketFactory
   </a>
  
      can be used to create SSL connections that allow the target 
   
     
          server to authenticate with a self-signed certificate.
   
     
        
   
    </li>
   
     

        
   
    <li>
      
     
         
   
    <a href="http://cvs.apache.org/viewcvs.cgi/jakarta-commons/httpclient/src/contrib/org/apache/commons/httpclient/contrib/ssl/StrictSSLProtocolSocketFactory.java?rev=HEAD">
       
   
     
          StrictSSLProtocolSocketFactory
   </a>
  
      can be used to create SSL connections that can optionally perform host name verification in order to help preventing man-in-the-middle type of attacks. 
   
     
        
   
    </li>
   
     

      
   
    </ul>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Known limitations and problems">Known limitations and problems</a>
        </h3>
      
      
    <ol>
      
     

        
   
    <li>
      
     
         
   
    <p>
      
     
          
   
    <strong>
      
     Persistent SSL connections do not work on Sun's JVMs below 1.4
   
    </strong>
   
     
         
   
    </p>
   
     
     
   
     
         
   
    <p>
      
     
         Due to what appears to be a bug in Sun's older (below 1.4) implementation of 
   
     
         Java Virtual Machines or JSSE there's no reliable way of telling if an SSL connection 
   
     
         is 'stale' or not. For example, the HTTP 1.1 specification permits HTTP servers in 
   
     
         'keep-alive' mode to drop the connection to the client after a given period inactivity 
   
     
         without having to notify the client, effectively rendering such connection unusable or 
   
     
         'stale'. For the HTTP agent written in Java there's no reliable way to test 
   
     
         if a connection is 'stale' other than attempting to perform a read on it.
   
     
         However, a read 
   
     
         operation on an idle SSL connection on Sun JVM older than 1.4 returns 'end of stream' 
   
     
         instead of an expected read timeout. That effectively makes the connection
   
      appear 'stale' 
   
     
         to HttpClient, which leaves it with no other way but to drop the connection and to 
   
     
         open a new one, thus defeating HTTP 1.1 keep-alive mechanism and resulting in significant 
   
     
         performance degradation (SSL authentication is a highly time consuming operation). The problem appears to have been fixed in Sun's 
   
     
         Java 1.4 SSL implementation.  Sockets which are not using HTTPS are
   
     
         unaffected on any JVM.
   
     
         
   
    </p>
   
     

         
   
    <p>
      
     
         
   
    <strong>
      
     Workaround:
   
    </strong>
   
      If persistent SSL connections support is an issue for your 
   
     
         application we strongly advise you to upgrade to Java 1.4.
   
     
         
   
    </p>
   
     
        
   
    </li>
   
     

        
   
    <li>
      
     
        
   
    <p>
      
     
         
   
    <strong>
      
     Non-preemptive authentication with a HTTPS server fails when connecting via a proxy
   
    </strong>
   
     
        
   
    </p>
   
     

        
   
    <p>
      
     
         This problem is caused by a serious flaw in HttpClient design and cannot be fixed without
   
     
         breaking the existing APIs. The problem will be addressed in HttpClient release 2.1.
   
     
        
   
    </p>
   
     
        
   
    <p>
      
     
         
   
    <strong>
      
     Workaround:
   
    </strong>
   
      Use preemptive server authentication or
   
     
         configure the server to keep the connection alive when returning an
   
     
         authorization challenge. Please note that only 
   
     
         BASIC authentication can be used preemptively. For more detailed
   
     
         information please refer to the
   
     
         
   
    <a href="authentication.html">
     Authentication Guide
   </a>
  
     .
   
     
        
   
    </p>
   
     
        
   
    </li>
   
     

      
   
    </ol>
   
    </div>
  
    <div class="h3">
      
      
        <h3>
          <a name="Troubleshooting">Troubleshooting</a>
        </h3>
      
      
    <p>
      
     
        JSSE is prone to configuration problems, especially on older JVMs,
   
     
        which it is not an integral part of.  As such, if you do encounter
   
     
        problems with SSL and HttpClient it is important to check that JSSE is
   
     
        correctly installed.
   
     
       
   
    </p>
   
    <p>
      
     
        The application below can be used as an ultimate test that can reliably
   
     
        tell if SSL configured properly, as it relies on a plain socket in
   
     
        order to communicate with the target serv
   
     er. If an exception is thrown
   
     
        when executing this code, SSL is not correctly installed and configured.
   
     
        Please refer to Sun's official resources for support or additional
   
     
        details on JSSE configuration.
   
     
       
   
    </p>
   
    <div id="source">
      <pre>
  import java.io.BufferedReader;
  import java.io.InputStreamReader;
  import java.io.OutputStreamWriter;
  import java.io.Writer;
  import java.net.Socket;

  import javax.net.ssl.SSLSocketFactory;

  public class Test {
        
     public static final String TARGET_HTTPS_SERVER = "www.verisign.com"; 
     public static final int    TARGET_HTTPS_PORT   = 443; 
        
     public static void main(String[] args) throws Exception {
        
       Socket socket = SSLSocketFactory.getDefault().
         createSocket(TARGET_HTTPS_SERVER, TARGET_HTTPS_PORT);
       try {
         Writer out = new OutputStreamWriter(
            socket.getOutputStream(), "ISO-8859-1");
         out.write("GET / HTTP/1.1\r\n");  
         out.write("Host: " + TARGET_HTTPS_SERVER + ":" + 
             TARGET_HTTPS_PORT + "\r\n");  
         out.write("Agent: SSL-TEST\r\n");  
         out.write("\r\n");  
         out.flush();  
         BufferedReader in = new BufferedReader(
            new InputStreamReader(socket.getInputStream(), "ISO-8859-1"));
         String line = null;
         while ((line = in.readLine()) != null) {
            System.out.println(line);
         }
       } finally {
         socket.close(); 
       }
     }
  }
        </pre>
    </div>
  
    </div>
  
                  
                  
                  
                  
                  
                </div>
              </div>
            </td>
          </tr>
        </table>
        <div id="footer">
          <table border="0" style="width:100%" cellpadding="4" cellspacing="0">
            
            <tr>
              <td>
                
                  
                    
                    
                      © 2001-2003, Apache Software Foundation
                    
                  
                  
                

                
              </td>
              
            </tr>
          </table>
        </div>
      </body>
    </html>
  